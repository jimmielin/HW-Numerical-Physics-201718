####################################################################
# Computational Physics, 2017-18 Sem1
# HW-2 Ex-2(3)-Plotting
#
# (c) 2017 Haipeng Lin <linhaipeng@pku.edu.cn>
# All Rights Reserved.
#
# This program is written as Homework for the Computational Physics
# Course in Peking University, School of Physics.
# NO WARRANTIES, EXPRESS OR IMPLIED, ARE OFFERED FOR THIS PRODUCT.
# Copying is strictly prohibited and its usage is solely restricted
# to uses permitted by the author and homework grading.
#
# This program is Python 3 (3.6.2 on MSYS_NT)
# compatible, and does not support Python 2.
#
# Now Playing: Kids In The Dark - All Time Low
####################################################################

## !!! FOR AN EXPLANATION OF WHY THESE SOLUTIONS ARE BUILT IN AND HOW THEY WERE GENERATED, SEE DOCUMENTATION !!! ##
## !!! THE ROOTS ARE PRE-SOLVED USING MY PROGRAM !!! ##
# Built-in Solutions for Hermite Polynomials
# So we don't spend time solving them all over again...
# !! BELOW DATAS ARE PADDED FOR MATHEMATICAL INDEXES !!
H96 = [None, -13.116130021662878, -12.529230746683542, -12.044806741134922, -11.613620828842913, -11.216875194202162, -10.844888073853587, -10.491854539276538, -10.153951274713688, -9.828492746191714, -9.513501769412425, -9.20746935337176, -8.909210581459599, -8.617773244214746, -8.33237730717006, -8.052373330719712, -7.777213031061239, -7.506427894427756, -7.239613294008353, -6.976416464285181, -6.716527240496519, -6.459670819555122, -6.20560202471831, -5.954100706411726, -5.704968013525535, -5.4580233400707865, -5.2131018018189605, -4.970052133166773, -4.728734920352931, -4.489021106216995, -4.250790715903187, -4.0139317636282685, -3.7783393087968626, -3.5439146360273117, -3.310564538524305, -3.0782006880468185, -2.846739077724783, -2.616099526362389, -2.38620523476978, -2.1569823861931283, -1.9283597841455025, -1.7002685219383507, -1.4726416790227095, -1.2454140399065081, -1.0185218319476799, -0.7919024787540168, -0.5654943662667489, -0.33923661887888523, -0.11306888315145194, 0.11306888315145194, 0.33923661887888523, 0.5654943662667489, 0.7919024787540168, 1.0185218319476799, 1.2454140399065081, 1.4726416790227095, 1.7002685219383507, 1.9283597841455025, 2.1569823861931283, 2.38620523476978, 2.616099526362389, 2.846739077724783, 3.0782006880468185, 3.310564538524305, 3.5439146360273117, 3.7783393087968626, 4.0139317636282685, 4.250790715903187, 4.489021106216995, 4.728734920352931, 4.970052133166773, 5.2131018018189605, 5.4580233400707865, 5.704968013525535, 5.954100706411726, 6.20560202471831, 6.459670819555122, 6.716527240496519, 6.976416464285181, 7.239613294008353, 7.506427894427756, 7.777213031061239, 8.052373330719712, 8.33237730717006, 8.617773244214746, 8.909210581459599, 9.20746935337176, 9.513501769412425, 9.828492746191714, 10.153951274713688, 10.491854539276538, 10.844888073853587, 11.216875194202162, 11.613620828842913, 12.044806741134922, 12.529230746683542, 13.116130021662878]

S0_6N1 = [9.50184088734183e-18, -1.536439889285927e-17, -1.460153127093814e-17, 1.155126120441206e-17, 1.319072673496347e-17, -2.641540765155574e-17, 9.83055152311242e-18, 7.054157682072672e-18, 4.130747563006747e-17, -2.287459980596968e-17, -5.308918969779802e-17, 2.650044716079638e-17, -3.176425331463927e-17, -2.552974877731873e-17, 1.687101556592608e-17, -3.309436542546889e-17, -1.080858585402827e-15, -2.615015593385091e-14, -5.102215718477447e-13, -7.843121584888983e-12, -9.64446284163438e-11, -9.63934736440495e-10, -7.94599527457613e-09, -5.475265538788094e-08, -3.192874704173231e-07, -1.593823947968285e-06, -6.883215318579925e-06, -2.597387869652705e-05, -8.64381734790784e-05, -0.0002559079826869755, -0.0006795801161667337, -0.001631359709994038, -0.003566213161260378, -0.007149027687100076, -0.01322974334035041, -0.02274369076627018, -0.03654089338519058, -0.0551792062526053, -0.07873795179071547, -0.1067087716206244, -0.1379975073986934, -0.1710356440050879, -0.2039679884763162, -0.2348670405952313, -0.2619273269753619, -0.2836097863358903, -0.298727950048392, -0.3064856800943984, -0.306485680094398, -0.2987279500483897, -0.2836097863358857, -0.2619273269753547, -0.2348670405952219, -0.2039679884763079, -0.1710356440050818, -0.1379975073986888, -0.1067087716206215, -0.07873795179071391, -0.05517920625260432, -0.03654089338519006, -0.02274369076627021, -0.01322974334035068, -0.007149027687100256, -0.003566213161260452, -0.001631359709994813, -0.0006795801161673958, -0.0002559079826876176, -8.64381734798992e-05, -2.597387869692018e-05, -6.883215318957565e-06, -1.593823948708115e-06, -3.192874705174271e-07, -5.475265539319917e-08, -7.945995276035953e-09, -9.6393457219672e-10, -9.64444858230137e-11, -7.84289078689482e-12, -5.101587827416708e-13, -2.603816583181251e-14, -1.052964432343892e-15, 5.664827395288828e-17, 7.331781482593604e-17, -9.44110340187214e-18, -1.464681127910259e-17, 2.392652558388192e-17, -3.834983506180325e-17, -1.573137174337403e-17, 6.206745048591653e-17, -6.334409026436918e-17, 2.412261984375649e-18, -1.40073183071448e-17, -8.92314955569237e-18, -2.185381875813533e-17, 1.175460622167361e-17, -9.83492089112512e-18, -1.060704090594324e-20]

S0_6N24 = [8.23904497421942e-14,-9.78840353173792e-14,1.133648288806401e-13,-1.296304588133917e-13,1.469341833286546e-13,-1.656618970019528e-13,1.85987796121084e-13,-2.079965190206259e-13,2.320523771999726e-13,-2.580977675284191e-13,2.861912201629458e-13,-3.354521341410952e-13,-1.247726293284759e-12,-8.91871134715115e-11,-3.315439624105749e-9,-8.55812319048838e-8,-1.563502155563371e-6,-0.00002061385501330289,-0.0001991232785624857,-0.001424535519899571,-0.007592025426060384,-0.03012543468708855,-0.0880866391852924,-0.1844736862501008,-0.2574197421691198,-0.1875152503555886,0.04304914431634888,0.2067560913593797,0.07157112936836595,-0.1691678974366596,-0.1077118850592705,0.1490210761095679,0.1099833133549483,-0.1478794283704719,-0.0955601348900916,0.1564999017198318,0.07046474349747891,-0.1666697396010424,-0.03821613632746237,0.1729378414261987,0.002140733872206472,-0.1725175421827599,0.0346528080516009,0.1646126981114305,-0.06968536504322936,-0.1495663302309086,0.1012366979892225,0.1281588875726257,-0.128158887572627,-0.1012366979892216,0.1495663302309097,0.06968536504322744,-0.1646126981114318,-0.03465280805159974,0.1725175421827609,-0.002140733872207495,-0.1729378414261996,0.03821613632746379,0.1666697396010431,-0.07046474349748106,-0.156499901719832,0.0955601348900935,0.1478794283704722,-0.1099833133549505,-0.1490210761095678,0.1077118850592723,0.1691678974366602,-0.07157112936836832,-0.2067560913593808,-0.04304914431634678,0.1875152503555917,0.2574197421691217,0.1844736862501017,0.0880866391852918,0.03012543468708813,0.007592025426059934,0.0014245355198995,0.000199123278562906,0.00002061385501340323,1.5635021551402e-6,8.55812316575538e-8,3.315439118882588e-9,8.9186754423144e-11,1.247477023346843e-12,3.35302370968647e-13,-2.860229736554265e-13,2.580706206791521e-13,-2.320146855753e-13,2.081226947330022e-13,-1.859993638086113e-13,1.656655802258241e-13,-1.470144679837672e-13,1.296263439845968e-13,-1.134478072432103e-13,9.79259389251194e-14,-8.23776749952696e-14]

S0_6N32 = [2.609203181486777e-11,-3.087212330655756e-11,3.560095792768458e-11,-4.052798446637719e-11,4.576552388955403e-11,-5.13901613467171e-11,5.746713988546474e-11,-6.405976442433396e-11,7.123403501216271e-11,-7.906288566111403e-11,8.75546245519125e-11,-1.048268075783022e-10,-4.141973879534442e-10,-2.233754989413764e-8,-6.232756891541306e-7,-0.00001181141281140886,-0.000153972027186493,-0.001398237586195922,-0.0088891804128273,-0.03935777820782322,-0.1187139007584047,-0.2301113301007588,-0.2405068959905226,-0.02489359118414393,0.201030905364655,0.06379361718663378,-0.1865193326887983,-0.01466091561782623,0.1800595865245147,-0.07816022384817181,-0.1240516675233549,0.1594043776275599,0.002022708918167838,-0.156484513703471,0.1262072421793724,0.0468575648885195,-0.1648156227943199,0.0984253444889244,0.07596518708935874,-0.1655580656188627,0.07275104675145963,0.0996695455991917,-0.1618983130858717,0.04545754707487122,0.1210691126495421,-0.1533893779838827,0.01554897683689802,0.139523091331818,-0.1395230913318195,-0.01554897683689621,0.1533893779838821,-0.1210691126495431,-0.04545754707486943,0.1618983130858722,-0.0996695455991936,-0.07275104675145783,0.1655580656188637,-0.07596518708936069,-0.0984253444889238,0.1648156227943222,-0.04685756488852135,-0.1262072421793719,0.1564845137034728,-0.002022708918170402,-0.159404377627561,0.1240516675233568,0.07816022384817018,-0.1800595865245161,0.01466091561782753,0.1865193326887995,-0.06379361718663517,-0.2010309053646553,0.02489359118414344,0.2405068959905231,0.2301113301007601,0.1187139007584063,0.03935777820782396,0.00888918041282746,0.001398237586195755,0.0001539720271866989,0.00001181141281199072,6.23275689089776e-7,2.233754971678673e-8,4.141974982380868e-10,1.048269279685773e-10,-8.75541564310677e-11,7.906291747450687e-11,-7.123395095679525e-11,6.405974559975464e-11,-5.74671342114491e-11,5.139024169433018e-11,-4.576551016368953e-11,4.052796011853424e-11,-3.560097046486076e-11,3.087212054114885e-11,-2.609204443810907e-11]

S1N1 = [1.569554432086398e-17,-6.321146955879899e-18,1.300849358945839e-17,-3.975351278649265e-17,5.222176960039262e-17,-5.042631991712167e-17,3.62565008969358e-17,-2.517263586548444e-17,6.588836209830243e-17,-7.787856971237171e-17,9.79622628126032e-17,-1.465190531129824e-16,1.859191233928575e-16,-1.651606078841295e-16,3.606727612424022e-16,-3.015237165333199e-16,4.474208353390733e-16,-5.225749489101027e-16,6.632014921449664e-16,-7.96076646237208e-16,1.063525065697321e-15,-1.319365844513731e-15,1.454182204320857e-15,-1.989061479666354e-15,2.246551977219561e-15,-2.921038262999171e-15,3.67823422514804e-15,-3.854138318584535e-15,3.250626860034346e-15,-1.937937772864217e-13,-1.267310667009275e-11,-5.327853519482146e-10,-1.452259285914316e-8,-2.653549061110108e-7,-3.354105849325499e-6,-0.00003022869253627576,-0.0001999763145905581,-0.000998654600794938,-0.003867720386960388,-0.01192337326023301,-0.02999956024982064,-0.06309536117934609,-0.113473057655596,-0.1782259843183621,-0.249195603429868,-0.3153548384716616,-0.3660521250142725,-0.3934195216575651,-0.3934195216575604,-0.3660521250142577,-0.3153548384716432,-0.2491956034298594,-0.1782259843183523,-0.1134730576555905,-0.06309536117935193,-0.02999956024982302,-0.01192337326024072,-0.003867720386962662,-0.000998654600791472,-0.0001999763145887647,-0.000030228692536182,-3.354105849686777e-6,-2.653549060325765e-7,-1.452259290045346e-8,-5.327860289639154e-10,-1.267348032915936e-11,-1.940343588603071e-13,2.891567939486893e-15,-3.797960064875423e-15,3.27697634392833e-15,-2.74994444783664e-15,2.493338180975187e-15,-1.810235877850798e-15,1.456829717688427e-15,-1.362000927352208e-15,9.4433854992449e-16,-7.313087014279686e-16,5.788269273797865e-16,-5.309615231237148e-16,4.926997031012485e-16,-3.023367291669723e-16,3.166784877704667e-16,-1.347467918068897e-16,2.066097770976683e-16,-1.638901753467804e-16,1.019556120470126e-16,-7.82575550743299e-17,9.06554831556501e-17,6.118886905096002e-17,3.227099104743437e-17,-4.354202187703649e-17,6.697159791664604e-18,-1.742272096059878e-17,-1.064459348144243e-17,-4.347599862167501e-17,9.04825972108815e-18]

S1N24 = [2.194043245719573e-6,-2.624332892264868e-6,3.060618185661177e-6,-3.52672208443766e-6,4.035339613078868e-6,-4.596739847461881e-6,5.220929471454454e-6,-5.918528160276737e-6,6.701272329478862e-6,-7.582395780904045e-6,8.57697274487569e-6,-9.70225581178983e-6,0.00001097801814081657,-0.00001242689398697782,0.000014074695478669,-0.00001595066139056759,0.00001808755989333804,-0.00002052151458755715,0.00002329134090571429,-0.00002643705284953831,0.00002999700672964216,-0.00003400286221109765,0.00003847113478127424,-0.00004338958139037487,0.00004869607289234644,-0.00005424724917655167,0.00005977471389264883,-0.00006486340671806989,0.00006627041642184124,-0.0001707925660609237,-0.002067666214448705,-0.0237773322931563,-0.1310527958009507,-0.3139352330222142,-0.1530793181660022,0.2602251167468379,-0.0967292075004286,-0.0869501143415211,0.1977633918855814,-0.2326475946554662,0.2127179785850926,-0.1586571918538654,0.0859960061542195,-0.006285294752680261,-0.07109585506113442,0.1379333924706569,-0.1871114275501614,0.2131920263687464,-0.2131920263687478,0.18711142755016,-0.1379333924706551,0.07109585506112549,0.006285294752687197,-0.0859960061542255,0.1586571918538689,-0.2127179785850929,0.2326475946554626,-0.1977633918855789,0.0869501143415157,0.0967292075004318,-0.2602251167468389,0.1530793181660082,0.3139352330222283,0.1310527958009552,0.02377733229315598,0.002067666214448163,0.0001707925660600013,-0.00006627041642341071,0.00006486340671840816,-0.00005977471389175849,0.00005424724917764586,-0.00004869607289208994,0.00004338958139002359,-0.00003847113478112136,0.00003400286221098836,-0.00002999700672967078,0.00002643705284927533,-0.00002329134090569847,0.00002052151458774212,-0.00001808755989332958,0.00001595066139060269,-0.00001407469547887088,0.00001242689398697934,-0.00001097801814084129,9.70225581170721e-6,-8.57697274491212e-6,7.582395780816875e-6,-6.701272329437229e-6,5.918528160267846e-6,-5.220929471414122e-6,4.596739847412441e-6,-4.035339613050678e-6,3.526722084434136e-6,-3.06061818567023e-6,2.624332892296743e-6,-2.194043245737769e-6]

S1N32 = [3.600297108052306e-7,-5.004604086862314e-7,6.650955291410598e-7,-8.65688526627429e-7,1.113760203112673e-6,-1.423141028117966e-6,1.811354674005063e-6,-2.301077708717665e-6,2.922010343596703e-6,-3.713414665619343e-6,4.727638670688476e-6,-6.03507944705624e-6,7.731258984113355e-6,-9.94703416749338e-6,0.0000128635161965516,-0.00001673416782401107,0.00002191801245035141,-0.00002893034009918366,0.00003852147969244561,-0.00005180151238367257,0.00007044186700195842,-0.0000970087233814704,0.0001355284041417818,-0.0001924727859381647,0.0002785281296313995,-0.0004118704946473331,0.0006242166197696328,-0.000991444089562248,0.000823732940966163,-0.0174250071078928,-0.1253393100605944,-0.4349965375632633,-0.2031276894867224,0.3492068829865983,-0.2745029425986147,0.1813171201625104,-0.1151552869111574,0.07386759142368589,-0.04875329982590071,0.03325946258103101,-0.02338986928064895,0.01683966857068373,-0.0122858558673913,0.00895601858684604,-0.006386397481506533,0.004288277523153584,-0.002473076972401305,0.000808594677884393,0.000808594677884632,-0.002473076972401485,0.004288277523153372,-0.006386397481506247,0.00895601858684474,-0.01228585586738939,0.0168396685706831,-0.02338986928064878,0.0332594625810294,-0.04875329982589843,0.07386759142368389,-0.1151552869111559,0.1813171201625069,-0.2745029425986033,0.3492068829865772,-0.2031276894867006,-0.4349965375632345,-0.1253393100605901,-0.01742500710789446,0.000823732940965875,-0.000991444089562099,0.0006242166197698023,-0.0004118704946472943,0.0002785281296310408,-0.000192472785938338,0.0001355284041419758,-0.0000970087233815755,0.00007044186700212695,-0.00005180151238355027,0.00003852147969252773,-0.00002893034009933076,0.00002191801245033233,-0.00001673416782411834,0.00001286351619647033,-9.94703416755502e-6,7.731258984148605e-6,-6.035079447068626e-6,4.727638670732779e-6,-3.713414665624723e-6,2.92201034358578e-6,-2.30107770869735e-6,1.811354674031138e-6,-1.423141028138674e-6,1.113760203117105e-6,-8.6568852666999e-7,6.650955292129661e-7,-5.00460408672191e-7,3.600297108089298e-7]


EigenVector = [None] + S1N32

# The results are the points \Psi(z_i) at nodes and we need to use Hermite base functions for interpolation

# HermitePoly(Int n, Numeric x)
# Computes Hermite Polynomial for given n, x, and accumulator Double x
def HermitePoly(n, x):
    if(n == 0):
        return 1
    if(n == 1):
        return x*2
    if(n == 2):
        return x*x*4 - 2

    Hs = [1, x*2, x*x*4 - 2]
    for i in range(3, n + 1):
        Hs.append(x*2*Hs[i-1] - Hs[i-2]*2*(i - 1))

    return Hs[n]

h97f = 1.9239179647166614e-91
h96f = 2.679707642602348e-90
h95f = 3.7131118291343105e-89
# This is h_96 ^ (-1/2), used as a reduction factor, precomputed numerically for highest precision
# ((math.pi)**(1/2) * 2**96 * math.factorial(96))**(-1/2)

e    = 2.718281828459045

# HermiteFn(Int n, Double x)
# Computes Hermite Function for given n, x.
def HermiteFn(n, x):
    if(n == 96):
        factor = h96f
    elif(n == 95):
        factor = h95f
    elif(n == 97):
        factor = h97f
    return factor * HermitePoly(n, x) * e**(-x*x/2)

# dHermiteFn(Int n, Double x)
# Returns derivative value of Hermite Function for given n, x.
def dHermiteFn(n, x):
    return (n/2)**(1/2) * HermiteFn(n - 1, x) - ((n+1)/2)**(1/2) * HermiteFn(n + 1, x)

# WeightFunction(Int i, Int n, Double x)
# Returns the value of a weighting function f_i(x)
def WeightFunction(i, n, x):
    return HermiteFn(n, x) / abs(dHermiteFn(n, H96[i])) * (-1 if i % 2 == 1 else 1) / (x - H96[i])

# Psi(x)
# Get the wavefunction!
def Psi(x):
    psi = 0
    for i in range(1, 96 + 1):
        Weight = WeightFunction(i, 96, x)
        psi += Weight * EigenVector[i]
    return psi

# Plotting...
partitions = 500
zs = [-10 + i * (20/partitions) for i in range(partitions)]
psis = [Psi(z/0.6) for z in zs]

import matplotlib.pyplot as plt
fig, ax = plt.subplots()
ax.plot(zs, psis)
plt.show()